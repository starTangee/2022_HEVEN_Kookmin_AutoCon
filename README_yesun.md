# 2022_Kookmin_AutoCon

2022 HEVEN 국민대학교 자율주행 경진대회 Repository

## 1. 예선과제 요약

세 줄 요약입니다.

1) 시뮬레이터 상에서 차선인식 및 자율주행 알고리즘 작성

2) Pygame 주차 시뮬레이터에서, AR 태그 인식 후 주차 알고리즘 작성

3) 본선 과제에 대한 SW 설계서 작성


## 2. 평가기준

1) 주행 품질

2) 주차 구역에 정확히 주차하는가?

3) SW 설계서의 완성도, 구체성, 타당성


## 3. 예선과제 설명 동영상 & 설명서

[예선 설명회 동영상](https://youtu.be/pFUoYn-VSZQ)

[과제 설명서](https://drive.google.com/drive/folders/1yP363VQAvsCm-cSuvj-_QqV4xFLUcUX7?usp=sharing)


## 4. 개발환경

ROS Melodic (Ubuntu 18.04)

### Dependency 및 설치:
(중간 중간에 sudo apt update 해줄 것!)

ROS Bridge  
`$ sudo apt install ros-melodic-rosbridge-server`  
  
    
ar-track-alvar v0.7.1  
`$ sudo apt-get install ros-melodic-ar-track-alvar`  
  
    
pygame v1.9.6  
`$ sudo apt-get install python-pip`  
`$ pip2 install pygame==1.9.6`  
  
    
pillow v6.2.2  
`$ pip2 install pillow==6.2.2`  


## 5. 미션별 상세한 설명

### 1) 차선인식 미션

#### 목표

• 시뮬레이터상에서 자동차가 차선을 벗어나지 않고 주행하게 만드는 것이 목표입니다.  
• 카메라로부터 640x480 크기의 영상을 ROS 토픽으로 받을 수 있습니다.  
• 차량 속도와 조향각을 제어하는 ROS 토픽을 발행할 수 있습니다.  

![image CCT0M1](https://user-images.githubusercontent.com/48710703/170824267-8b3ec4ae-9d99-412a-877c-8567e43e5af2.png)  

시뮬레이터가 제공하는 카메라 이미지를 영상처리하여 차선의 위치를 찾고,  
이를 계산해 차선을 벗어나지 않고 주행할 수 있는 조향각을 찾아내고,  
모터제어 토픽을 시뮬레이터로 보내 차량이 차선을 벗어나지 않도록 운전하면 됩니다.  

#### 실행 방법

① ROS Bridge 실행  
`$ roslaunch rosbridge_server rosbridge_websocket.launch`  
  
② 시뮬레이터 실행 (파일이 있는 폴더로 가서 실행)  
`$ ./xycar3dsimulator.x86_64`  
  
③ Launch 파일 실행 (자신이 작성한 자율주행 파이썬 코드)  
`$ roslaunch my_hough h_drive_sim.launch`  
  
자동주행 모드로 시작하고, 스페이스 바를 누를 때 마다 수동 <-> 자동 모드 변경 가능  
수동 주행은 키보드 상하좌우 키로 조작  

#### 주행 경로
![Screenshot from 2022-05-28 20-54-32](https://user-images.githubusercontent.com/48710703/170824426-3c5fa008-e91f-4d32-a65c-5eab4344d07d.png)

### 2) 주차 미션

#### 목표

• 시뮬레이터상에서 자동차가 주차구역에 정확하게 주차하게 만드는 것이 목표입니다.  
• AR 센서로부터 AR태그의 거리와 자세정보를 ROS 토픽으로 받을 수 있습니다.  
• 차량 속도와 조향각을 제어하는 ROS 토픽을 발행할 수 있습니다.  
▪ 주차구역에 정확하게 주차하면 주차구역이 녹색으로 바뀝니다. 주차 성공여부를 알 수 있습니다.  

시뮬레이터가 제공하는 AR태그의 거리와 자세 정보를 분석하여 주차구역까지의 거리와 차량과의 각도를 알아내고,  
주차가 가능한 적절한 주행 경로와 방법을 찾아내고,  
모터제어 토픽을 시뮬레이터로 보내 차량이 주차구역에 정확하게 주차할 수 있도록 운전하면 됩니다.  
![image](https://user-images.githubusercontent.com/48710703/170824583-0c96eb62-4fdf-4cb8-8842-6a6e127c496b.png)  
![image](https://user-images.githubusercontent.com/48710703/170824575-3b6b9589-2e9e-4c34-9eee-6f264e841537.png)  

#### 실행 방법

`$ roslaunch assignment2 parking.launch`

차량을 출발시킨 뒤, 키보드 1, 2, 3, 4 를 누르면 각각 정해진 처음 위치로 이동됨.

### 3) 자율주행 SW 설계서

미리 작성된 예시를 참고하여 나머지 5개 미션에 대한 SW 설계서를 작성하면 됩니다.  
어떤 센서를 사용할지 적고, 어떤 기능이 필요한지, 그 기능을 어떤 방법으로 구현할 것인지 간단히 계획을 기술하면 됩니다.  
뒤쪽에는 사전 조사를 통해 공부한 활용기술들에 대해서 간단히 그림 등으로 정리하면 됩니다.  

#### 본선 미션

1) 차선을 벗어나지 않고 주행  
주행트랙에서 차량이 차선을 벗어나지 않고 주행해야 함.  
코너와 곡선구간 차선 위에 세워 둔 차선이탈 판정용 블록을 쓰러뜨리지 않아야 함.  
  
2) 어두운 터널을 통과
카메라 영상으로 차선을 인식하는 것이 불가능한 어두운 터널 안에서  
거리센서(초음파센서 또는 라이다)를 이용해서 벽과 충돌하지 않으면서 주행하여 터널을 빠져나와야 함.  
  
3) 장애물을 피해서 주행  
도로 위에 놓인, 차선 안쪽에 놓인 장애물과 충돌하지 않고 피해서 주행해야 함.  
차선을 잠시 벗어날 수도 있으나, 장애물을 모두 피한 후에는 정상적으로 차선 안쪽으로 되돌아와서 주행해야 함.  
  
4) 정지선 정차 후 일정시간 후에 다시 재출발하여 주행  
정지선을 발견하면 지나치지 않고 정지선 앞에 정차해야 함.    
정차 후 일정시간(3초)이 지나면 다시 출발하여야 함.   
한계시간(5초)이 지나도록 계속 정차해 있으면 안됨.  
  
5) T자 수직주차 후 다시 출발
후진으로 2대의 차량 사이에 수직으로 주차함.  
주차 과정에서 양쪽 차량과 접촉사고가 나거나 후면 벽과 충돌하면 안됨.  
3초 정차한 후 다시 빠져나와 주행트랙으로 복귀하여 계속 주행해야 함.  
5초 이상 계속 주차하고 있으면 안됨.  
  
6) 평행주차
후진 또는 전진으로 트랙과 수평으로 놓인 주차구역에 주차함.  
벽 또는 장애물과 충돌하면 안됨. 주차구역 앞쪽 벽에 붙여 놓은 AR코드를 이용하여  
차량이 AR코드를 정면으로 바라보는 위치에 똑바로 정확히 주차해야 함.
  
